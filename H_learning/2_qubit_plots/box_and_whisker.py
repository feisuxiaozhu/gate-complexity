import numpy as np
import matplotlib.pyplot as plt


# t_total, mean, std, varying shot 
data = {
    # varying shots
    3: {
        "T_total": [1.690e+06,1.386e+07,1.696e+08,2.066e+09,1.670e+10],
        "l2_mean": [2.138e-02,1.865e-02,1.686e-02,1.668e-02,1.505e-02],
        "std": [2.542e-02,1.914e-02,1.986e-02,1.851e-02,1.566e-02],
        "median": [1.379e-02,1.119e-02,8.961e-03,9.818e-03,7.521e-03],
        "p25": [5.106e-03,5.074e-03,4.869e-03,5.256e-03,4.542e-03],
        "p35": [7.517e-03,6.797e-03,6.453e-03,6.631e-03,6.410e-03],
        "p65": [2.240e-02,2.058e-02,1.678e-02,1.518e-02,1.567e-02],
        "p75": [2.837e-02,2.893e-02,2.457e-02,2.544e-02,2.622e-02], 
        
    },
    4: {
        "T_total": [1.534e+06,1.259e+07,1.541e+08,1.876e+09,1.516e+10],
        "l2_mean": [8.678e-03,3.194e-03,3.400e-03,4.606e-03,1.943e-03],
        "std": [1.869e-02,7.839e-03,9.130e-03,1.227e-02,5.875e-03],
        "median": [9.896e-04,1.273e-04,1.108e-05,1.105e-06,8.871e-07],
        "p25": [8.213e-04,1.035e-04,9.425e-06,8.380e-07,1.066e-07],
        "p35": [8.983e-04,1.120e-04,1.018e-05,9.344e-07,1.210e-07],
        "p65": [1.569e-03,1.754e-04,2.484e-05,2.492e-05,1.649e-05],
        "p75": [6.866e-03,2.365e-03,2.069e-04,7.289e-04,1.316e-04], 
    },
    # 4.2: {
    #     "T_total": [1.507e+06,1.236e+07,1.513e+08,1.842e+09,2.233e+10],
    #     "median": [1.017e-03,1.207e-04,1.183e-05,1.019e-06,9.261e-08],
    #     "p25": [8.360e-04,1.034e-04,8.910e-06,8.376e-07,7.238e-08],
    #     "p35": [8.797e-04,1.111e-04,9.803e-06,9.115e-07,7.906e-08],
    #     "p65": [1.650e-03,1.669e-04,5.682e-05,6.522e-06,2.152e-06],
    #     "p75": [4.476e-03,1.216e-03,8.634e-04,3.563e-04,9.992e-05],
    # },
    # 4.4:{
    #     "T_total": [1.480e+06,1.822e+07,1.486e+08,1.809e+09,2.194e+10],
    #     "median": [1.040e-03,9.022e-05,1.148e-05,1.014e-06,1.003e-07],
    #     "p25": [8.317e-04,7.072e-05,9.146e-06,8.073e-07,7.286e-08],
    #     "p35": [8.996e-04,7.741e-05,1.020e-05,8.667e-07,7.927e-08],
    #     "p65": [2.135e-03,1.146e-03,3.230e-05,1.057e-05,4.919e-05],
    #     "p75": [4.577e-03,4.020e-03,8.784e-04,1.016e-03,4.034e-04],
        
    # },
    # 4.6:{
    #     "T_total": [ 1.454e+06, 1.790e+07,1.460e+08, 1.778e+09,2.156e+10],
    #     "median": [9.019e-04,7.983e-05,1.012e-05,8.776e-07,8.150e-08],
    #     "p25": [7.657e-04,6.820e-05,8.811e-06,7.449e-07,7.101e-08],
    #     "p35": [8.126e-04,7.257e-05,9.449e-06,7.993e-07,7.548e-08],
    #     "p65": [1.027e-03,8.899e-05,1.136e-05,9.810e-07,9.492e-08],
    #     "p75": [1.216e-03,9.652e-05,1.382e-05,1.207e-06,1.603e-06],
    # },
    # 4.8: {
    #     "T_total": [1.429e+06, 1.759e+07, 1.435e+08,1.747e+09,2.119e+10],
    #     "median": [8.855e-04,7.701e-05,1.053e-05,8.887e-07,7.792e-08],
    #     "p25": [7.607e-04,6.541e-05,8.924e-06,7.804e-07,6.633e-08],
    #     "p35": [8.051e-04,7.070e-05,9.633e-06,8.125e-07,7.173e-08],
    #     "p65": [1.025e-03,8.475e-05,1.163e-05,1.026e-06,9.006e-08],
    #     "p75": [1.138e-03,9.402e-05,1.406e-05,1.412e-06,1.962e-07],
        
    # },
    5: {
        "T_total": [1.405e+06,1.730e+07,1.411e+08,1.718e+09,2.083e+10],
        "l2_mean": [1.830e-03,1.111e-03,4.686e-04,4.456e-04,3.491e-04],
        "std": [4.164e-03,6.013e-03,2.041e-03,3.841e-03,3.073e-03],
        "median": [8.718e-04,7.644e-05,9.896e-06,9.097e-07,7.531e-08],
        "p25": [7.594e-04,6.562e-05,8.535e-06,7.815e-07,6.371e-08],
        "p35": [8.022e-04,6.969e-05,9.117e-06,8.451e-07,6.929e-08],
        "p65": [9.329e-04,8.724e-05,1.105e-05,9.884e-07,8.253e-08],
        "p75": [9.986e-04,9.618e-05,1.252e-05,1.074e-06,8.828e-08],
        
    },
    6: {
        "T_total": [1.296e+06,1.596e+07,1.952e+08,1.585e+09,1.921e+10],
        "l2_mean": [1.490e-03,5.329e-04,9.611e-05,1.886e-04,9.749e-05],
        "std": [4.017e-03,2.253e-03,4.077e-04,1.167e-03,7.788e-04],
        "median": [9.237e-04,8.329e-05,7.233e-06,9.112e-07,7.789e-08],
        "p25": [8.150e-04,7.170e-05,6.382e-06,7.961e-07,6.785e-08],
        "p35": [8.582e-04,7.684e-05,6.746e-06,8.413e-07,7.164e-08],
        "p65": [9.889e-04,9.229e-05,7.788e-06,1.006e-06,8.418e-08],
        "p75": [1.063e-03,9.891e-05,8.211e-06,1.074e-06,9.077e-08],
        
    },
    10: {
        "T_total": [1.484e+06,1.826e+07,1.490e+08,1.814e+09,2.199e+10],
        "l2_mean": [2.026e-03, 1.288e-03,4.069e-04,1.240e-03,9.841e-05],
        "std": [7.585e-03,7.098e-03,2.776e-03,8.232e-03,1.182e-03],
        "median": [7.626e-04,6.832e-05,8.992e-06,7.914e-07,6.764e-08],
        "p25": [6.786e-04,5.948e-05,7.918e-06,6.713e-07,5.994e-08],
        "p35": [7.143e-04,6.318e-05,8.274e-06,7.200e-07,6.254e-08],
        "p65": [8.484e-04,7.514e-05,9.633e-06,8.592e-07,7.310e-08],
        "p75": [9.043e-04,7.951e-05,1.013e-05,9.087e-07,7.812e-08],
    },
    25: {
        "T_total": [1.179e+06,1.451e+07,1.775e+08,1.441e+09,1.747e+10],
        "l2_mean": [3.762e-03,7.491e-04,4.385e-04,2.020e-04,4.266e-04],
        "std": [1.369e-02,4.559e-03,2.345e-03,2.802e-03,5.442e-03],
        "median": [1.014e-03,8.694e-05,7.433e-06,9.672e-07,8.431e-08],
        "p25": [8.930e-04,7.512e-05,6.309e-06,8.249e-07,7.515e-08],
        "p35": [9.353e-04,8.177e-05,6.839e-06,8.863e-07,7.901e-08],
        "p65": [1.086e-03,9.340e-05,8.159e-06,1.026e-06,8.938e-08],
        "p75": [1.161e-03,9.883e-05,8.475e-06,1.096e-06,9.443e-08],
    },
    
}

def y_and_errors(med, p35, p65, p25=None, p75=None):
    """Return y plus two asymmetric errorbars:
       - yerr_box:  from p35–p65 (your current bar)
       - yerr_whisk: from p25–p75 (whiskers), if provided
    """
    med = np.asarray(med, float)
    p35 = np.asarray(p35, float)
    p65 = np.asarray(p65, float)

    lo_box = np.minimum(p35, p65)
    hi_box = np.maximum(p35, p65)

    y = np.log10(1.0 / med)
    y_upper_box = np.log10(1.0 / lo_box) - y
    y_lower_box = y - np.log10(1.0 / hi_box)
    yerr_box = np.vstack([y_lower_box, y_upper_box])

    yerr_whisk = None
    if p25 is not None and p75 is not None:
        p25 = np.asarray(p25, float)
        p75 = np.asarray(p75, float)
        lo_w = np.minimum(p25, p75)
        hi_w = np.maximum(p25, p75)
        y_upper_w = np.log10(1.0 / lo_w) - y
        y_lower_w = y - np.log10(1.0 / hi_w)
        yerr_whisk = np.vstack([y_lower_w, y_upper_w])

    return y, yerr_box, yerr_whisk

plt.figure(figsize=(7, 5))
slopes = {}

for nu, d in data.items():
    T_total = np.asarray(d["T_total"], float)
    med     = np.asarray(d["median"], float)
    p35     = np.asarray(d["p35"], float)
    p65     = np.asarray(d["p65"], float)
    p25     = np.asarray(d["p25"], float)
    p75     = np.asarray(d["p75"], float)

    log_T = np.log10(T_total)
    y, yerr_box, yerr_whisk = y_and_errors(med, p35, p65, p25, p75)

    # Fit on median
    slope, intercept = np.polyfit(log_T, y, 1)
    slopes[nu] = (slope, intercept)

    # Main (box) error bar: 35–65%
    line = plt.errorbar(
        log_T, y, yerr=yerr_box,
        fmt='o-', capsize=3, elinewidth=1.4, alpha=0.95, label=f'ν={nu}'
    )
    color = line[0].get_color()

    # Whiskers: 25–75% (no markers/line, just whiskers)
    plt.errorbar(
        log_T, y, yerr=yerr_whisk,
        fmt='none', ecolor=color, elinewidth=0.9, alpha=0.6, capsize=6
    )

plt.xlabel('log10(T_total)')
plt.ylabel('log10(1 / l2_error)  (median)')
plt.title('Median with 35–65% bars and 25–75% whiskers')
plt.grid(True, linestyle='--', alpha=0.6)
plt.legend(ncol=2, frameon=False)
plt.tight_layout()
plt.show()