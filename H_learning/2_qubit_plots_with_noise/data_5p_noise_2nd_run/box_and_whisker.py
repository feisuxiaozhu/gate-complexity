import numpy as np
import matplotlib.pyplot as plt

# ---------------- data (as given) ----------------
data = {
  3: {
        "T_total": [1.690e+06,1.386e+07,1.696e+08,2.066e+09,1.670e+10], 
        "median":  [2.294e-02,2.200e-02,1.605e-02,1.712e-02,1.139e-02], 
        "p25":     [8.671e-03,7.266e-03,6.865e-03,6.502e-03,5.716e-03], 
        "p35":     [1.334e-02,1.155e-02,9.599e-03,9.402e-03,7.098e-03], 
        "p65":     [2.995e-02,2.829e-02,2.601e-02,2.603e-02,2.398e-02], 
        "p75":     [3.566e-02,3.906e-02,3.298e-02,3.110e-02,2.746e-02],
    },
  3.5: {
        "T_total": [1.608e+06,1.320e+07,1.615e+08,1.966e+09,1.589e+10],
        "median":  [1.967e-03,8.624e-04,9.289e-04,5.493e-04,4.825e-04],
        "p25":     [1.045e-03,1.537e-04,9.994e-05,2.003e-05,1.865e-05],
        "p35":     [1.186e-03,4.251e-04,3.616e-04,1.160e-04,9.753e-05],
        "p65":     [6.558e-03,3.649e-03,4.046e-03,2.712e-03,1.708e-03],
        "p75":     [1.516e-02,8.588e-03,8.463e-03,6.950e-03,4.744e-03],
    },
  4: {
        "T_total": [1.534e+06,1.259e+07,1.541e+08,1.876e+09,1.516e+10],
        "median":  [3.585e-03,8.236e-04,3.827e-04,1.457e-04,6.049e-05],
        "p25":     [1.057e-03,1.423e-04,1.389e-05,1.195e-06,2.708e-07],
        "p35":     [1.404e-03,1.899e-04,5.818e-05,7.677e-06,3.136e-06],
        "p65":     [1.005e-02,5.535e-03,4.477e-03,1.305e-03,1.020e-03],
        "p75":     [1.344e-02,1.142e-02,9.841e-03,4.267e-03,4.935e-03],
    },
  4.5: {
        "T_total": [1.467e+06,1.806e+07,1.473e+08,1.793e+09,2.175e+10],
        "median":  [1.332e-03,2.011e-04,8.023e-05,1.319e-05,5.499e-07],
        "p25":     [9.001e-04,8.319e-05,1.019e-05,9.159e-07,7.635e-08],
        "p35":     [1.040e-03,9.163e-05,1.177e-05,1.059e-06,8.874e-08],
        "p65":     [4.664e-03,9.656e-04,8.040e-04,3.206e-04,5.154e-05],
        "p75":     [1.275e-02,4.258e-03,2.600e-03,1.276e-03,4.194e-04],
    },
  5: {
        "T_total": [1.405e+06,1.730e+07,1.411e+08,1.718e+09,2.083e+10],
        "median":  [1.004e-03,9.917e-05,1.353e-05,1.082e-06,9.823e-08],
        "p25":     [8.532e-04,7.654e-05,1.029e-05,8.862e-07,7.783e-08],
        "p35":     [8.934e-04,8.201e-05,1.153e-05,9.568e-07,8.285e-08],
        "p65":     [1.169e-03,2.675e-04,7.704e-05,3.461e-06,2.303e-06],
        "p75":     [2.059e-03,6.895e-04,3.872e-04,1.818e-05,2.467e-05],
    },
#   5.5: {
#         "T_total": [1.349e+06,1.660e+07,1.354e+08,1.649e+09,1.999e+10],
#         "median":  [1.113e-03,9.209e-05,1.276e-05,1.162e-06,9.557e-08],
#         "p25":     [8.836e-04,7.649e-05,1.031e-05,8.920e-07,7.702e-08],
#         "p35":     [9.717e-04,8.291e-05,1.097e-05,9.749e-07,8.495e-08],
#         "p65":     [1.504e-03,1.063e-04,2.237e-05,2.533e-05,1.681e-07],
#         "p75":     [3.647e-03,3.195e-04,2.209e-04,5.289e-04,6.161e-05],
#     },
  6: {
        "T_total": [1.296e+06,1.596e+07,1.952e+08,1.585e+09,1.921e+10],
        "median":  [1.067e-03,9.770e-05,8.269e-06,1.080e-06,8.877e-08],
        "p25":     [8.967e-04,7.860e-05,6.813e-06,9.096e-07,7.502e-08],
        "p35":     [9.643e-04,8.756e-05,7.496e-06,9.631e-07,7.863e-08],
        "p65":     [1.181e-03,1.284e-04,9.493e-06,1.305e-06,1.005e-07],
        "p75":     [1.436e-03,6.750e-04,6.940e-05,3.966e-05,1.185e-07],
    },
#   6.5: {
#         "T_total": [1.248e+06,1.536e+07,1.879e+08,1.525e+09,1.850e+10],
#         "median":  [1.077e-03,9.490e-05,8.213e-06,1.098e-06,9.127e-08],
#         "p25":     [9.315e-04,8.124e-05,6.758e-06,9.146e-07,7.676e-08],
#         "p35":     [9.815e-04,8.747e-05,7.306e-06,9.777e-07,8.181e-08],
#         "p65":     [1.199e-03,1.107e-04,9.567e-06,1.247e-06,1.148e-07],
#         "p75":     [1.326e-03,1.810e-04,4.896e-05,1.666e-05,8.859e-06],
#     },
  7: {
        "T_total": [1.203e+06,1.481e+07,1.812e+08,1.471e+09,1.783e+10],
        "median":  [1.129e-03,9.702e-05,8.507e-06,1.111e-06,9.385e-08],
        "p25":     [9.567e-04,8.107e-05,7.263e-06,9.235e-07,7.944e-08],
        "p35":     [1.011e-03,8.724e-05,7.550e-06,1.007e-06,8.415e-08],
        "p65":     [1.305e-03,1.176e-04,9.388e-06,1.337e-06,1.056e-07],
        "p75":     [1.604e-03,2.066e-04,1.638e-05,1.225e-05,1.274e-07],
    },
#   7.5: {
#         "T_total": [1.161e+06,1.429e+07,1.749e+08,1.419e+09,1.721e+10],
#         "median":  [1.090e-03,1.020e-04,8.987e-06,1.147e-06,1.010e-07],
#         "p25":     [9.641e-04,8.727e-05,7.455e-06,9.505e-07,7.967e-08],
#         "p35":     [1.009e-03,9.387e-05,7.906e-06,1.040e-06,8.769e-08],
#         "p65":     [1.243e-03,1.164e-04,1.050e-05,1.340e-06,1.144e-07],
#         "p75":     [1.352e-03,1.505e-04,3.029e-05,5.573e-06,8.807e-07],
#     },
  8: {
        "T_total": [1.683e+06,1.381e+07,1.690e+08,2.058e+09,1.663e+10],
        "median":  [7.919e-04,1.050e-04,8.825e-06,7.770e-07,1.010e-07],
        "p25":     [6.759e-04,8.999e-05,7.355e-06,6.311e-07,8.872e-08],
        "p35":     [7.204e-04,9.449e-05,7.968e-06,6.948e-07,9.287e-08],
        "p65":     [8.810e-04,1.254e-04,9.874e-06,8.486e-07,1.157e-07],
        "p75":     [1.099e-03,3.920e-04,1.188e-05,9.361e-07,1.367e-07],
    },
#   8.5: {
#         "T_total": [1.629e+06,1.336e+07,1.635e+08,1.991e+09,1.609e+10],
#         "median":  [8.115e-04,1.116e-04,9.759e-06,8.311e-07,1.037e-07],
#         "p25":     [6.957e-04,9.436e-05,8.258e-06,6.894e-07,8.696e-08],
#         "p35":     [7.458e-04,1.020e-04,8.848e-06,7.579e-07,9.581e-08],
#         "p65":     [9.333e-04,1.285e-04,1.223e-05,9.332e-07,1.136e-07],
#         "p75":     [1.119e-03,2.639e-04,1.772e-04,2.121e-06,1.302e-07],
#     },
#   9: {
#         "T_total": [1.577e+06,1.294e+07,1.584e+08,1.928e+09,1.559e+10],
#         "median":  [8.486e-04,1.084e-04,9.479e-06,8.516e-07,1.057e-07],
#         "p25":     [7.337e-04,9.107e-05,7.848e-06,7.170e-07,8.970e-08],
#         "p35":     [7.810e-04,1.012e-04,8.460e-06,7.707e-07,9.518e-08],
#         "p65":     [9.454e-04,1.218e-04,1.051e-05,1.835e-06,1.141e-07],
#         "p75":     [1.085e-03,1.541e-04,1.256e-05,5.010e-05,1.389e-07],
#     },
#   9.5: {
#         "T_total": [1.529e+06,1.255e+07,1.535e+08,1.869e+09,1.511e+10],
#         "median":  [8.885e-04,1.106e-04,9.744e-06,8.306e-07,1.056e-07],
#         "p25":     [7.557e-04,9.509e-05,8.127e-06,7.190e-07,9.186e-08],
#         "p35":     [8.040e-04,1.020e-04,8.774e-06,7.739e-07,9.812e-08],
#         "p65":     [1.013e-03,1.256e-04,1.089e-05,9.438e-07,1.163e-07],
#         "p75":     [2.151e-03,1.480e-04,1.389e-05,1.132e-06,1.290e-07],
#     },
#   10: {
#         "T_total": [1.484e+06,1.826e+07,1.490e+08,1.814e+09,2.199e+10],
#         "median":  [9.000e-04,7.828e-05,1.017e-05,8.738e-07,7.358e-08],
#         "p25":     [7.543e-04,6.662e-05,8.452e-06,7.436e-07,6.338e-08],
#         "p35":     [8.024e-04,7.057e-05,9.275e-06,8.000e-07,6.786e-08],
#         "p65":     [1.039e-03,8.881e-05,1.183e-05,9.544e-07,8.121e-08],
#         "p75":     [2.151e-03,2.302e-04,3.222e-05,1.100e-06,8.953e-08],
#     },
}

# ---------------- helpers ----------------
def y_and_errors(med, p35, p65, p25=None, p75=None):
    med = np.asarray(med, float)
    p35 = np.asarray(p35, float)
    p65 = np.asarray(p65, float)

    lo_box = np.minimum(p35, p65)
    hi_box = np.maximum(p35, p65)

    y = np.log10(1.0 / med)
    y_upper_box = np.log10(1.0 / lo_box) - y
    y_lower_box = y - np.log10(1.0 / hi_box)
    yerr_box = np.vstack([y_lower_box, y_upper_box])

    yerr_whisk = None
    if p25 is not None and p75 is not None:
        p25 = np.asarray(p25, float)
        p75 = np.asarray(p75, float)
        lo_w = np.minimum(p25, p75)
        hi_w = np.maximum(p25, p75)
        y_upper_w = np.log10(1.0 / lo_w) - y
        y_lower_w = y - np.log10(1.0 / hi_w)
        yerr_whisk = np.vstack([y_lower_w, y_upper_w])
    return y, yerr_box, yerr_whisk

# ---------------- PRL-ish style ----------------
plt.rcParams.update({
    "figure.dpi": 300,
    "savefig.dpi": 600,
    "font.size": 8,
    "axes.labelsize": 9,
    "xtick.labelsize": 8,
    "ytick.labelsize": 8,
    "legend.fontsize": 7,
    "lines.linewidth": 1.2,
    "axes.linewidth": 0.8,
    "mathtext.default": "it",
})

# PRL single-column width ~3.37 in
fig = plt.figure(figsize=(3.37, 2.60))
ax = plt.gca()

# ---------------- plot ----------------
for nu, d in sorted(data.items()):
    T_total = np.asarray(d["T_total"], float)
    med     = np.asarray(d["median"], float)
    p35     = np.asarray(d["p35"], float)
    p65     = np.asarray(d["p65"], float)
    p25     = np.asarray(d["p25"], float)
    p75     = np.asarray(d["p75"], float)

    x = np.log10(T_total)
    y, yerr_box, yerr_whisk = y_and_errors(med, p35, p65, p25, p75)

    line = ax.errorbar(
        x, y, yerr=yerr_box, fmt='o-', markersize=3, capsize=2.5,
        elinewidth=1.0, alpha=0.95, label=rf'$\nu={nu}$'
    )
    color = line[0].get_color()
    ax.errorbar(
        x, y, yerr=yerr_whisk, fmt='none',
        ecolor=color, elinewidth=0.8, alpha=0.6, capsize=4
    )

# # dotted slope-1 guide (any intercept)
# x1, x2 = ax.get_xlim()
# b = -1.5
# ax.plot([x1, x2], [x1 + b, x2 + b], ':', color='k', linewidth=1.0, label='slope $1$')

# dotted slope-1 guide, shifted down
x1, x2 = ax.get_xlim()
y1, y2 = ax.get_ylim()
dy = -0.45 * (y2 - y1)
ax.plot([x1, x2], [x1 + dy, x2 + dy], ':', color='k', linewidth=1.2, label='slope $1$')

# math axis labels
ax.set_xlabel(r'$\log_{10} T_{\mathrm{total}}$')
ax.set_ylabel(r'$\log_{10}(1/\epsilon_{\ell_2})$')

ax.grid(True, linestyle='--', linewidth=0.5, alpha=0.5)
ax.legend(ncol=2, frameon=False, handlelength=2.0, columnspacing=0.8)

fig.tight_layout()
plt.show()

# To save for submission:
# fig.savefig("prl_single_column_plot.pdf", bbox_inches="tight")
# fig.savefig("prl_single_column_plot.png", bbox_inches="tight")
